CREATE DEFINER=`lutransport`@`%` PROCEDURE `company_customer_update`()
BEGIN


DECLARE done int DEFAULT 0;
DECLARE flag int DEFAULT 0;
DECLARE done_holder int;

DECLARE customer_ids varchar(225);
DECLARE compnay_locations varchar(200);
DECLARE ticket_id bigint(20);
DECLARE bill_history_id bigint(150);



DECLARE Company_Name varchar(225);
DECLARE Customer_Names varchar(255);


DECLARE masterCursor CURSOR for select id,customer_id,company_location
from ticket where id in (22292, 22293, 22294, 22295, 22296, 22297, 24874, 24875, 27064, 33425, 57425, 60460, 63583, 65864, 68468, 68990, 69371, 70910, 71345, 72086, 72087, 72089, 73290, 83681, 87214, 90543, 92404, 92981, 95255, 95627, 96136, 97365, 99464, 99475, 101212, 101705, 101716, 103969, 106031, 114687, 120210, 120211, 124479, 138526, 127064, 127077, 127111, 127112, 127114, 127115, 127116, 127121, 127221, 127222, 128038, 128040, 128047, 128071, 128073, 128075, 130350, 130351, 130352, 130353, 130354, 130441, 130442, 130443, 130516, 130517, 133307, 133308, 133309, 133310, 133311, 133312, 133313, 133360, 133362, 133363, 133364, 133399, 136421, 136521, 136522, 136523, 136524, 136525, 136575, 136576, 136577, 243149, 242974, 242934, 233903, 242576, 242816, 242653, 242769, 242977, 242936, 243957, 242780, 242966, 242940, 243659, 242938, 242942, 243862, 243253, 242778, 242776, 242927, 242929, 242856, 242585, 242772, 243429, 244234, 242864, 242933, 242779, 242474, 242926, 242270, 243958, 242888, 242236, 241993, 243597, 242858, 243130, 242793, 242789, 243012, 243676, 243157, 242950, 243123, 241928, 242812, 242855, 242357, 242464, 242365, 244523, 242852, 242725, 241925, 242360, 242753, 242468, 242465, 241924, 242452, 242467, 242952, 242692, 242722, 242761, 242471, 242828, 241994, 242849, 242364, 242473, 242931, 242757, 242720, 242719, 242765, 242758, 242859, 242469, 242363, 241655, 242352, 243132, 242771, 242774, 242861, 243651, 242985, 242786, 242883, 243680, 242889, 242860, 244280, 242763, 244237, 242853, 241693, 243377, 242272, 242456, 243256, 243865, 242795, 243325, 243838, 243661, 243598, 243126, 242163, 242885, 242766, 243426, 242589, 241698, 242242, 242016, 242588, 241986, 242988, 242162, 243430, 243373, 241985, 243653, 241996, 242647, 242454, 242644, 242582, 242274, 243602, 243324, 244232, 244282, 243849, 243328, 241695, 243829, 243375, 242239, 242161, 242813, 242383, 242706, 242809, 242819, 242385, 242578, 242642, 242646, 242650, 242652, 242930, 243665, 242863, 243655, 244281, 240937, 240907, 240938, 240908, 240904, 240935, 240905, 240936, 240903, 240932, 240909, 240931, 240910, 240933, 243557, 242810, 244239, 244228, 245045, 244905, 244909, 249382, 244908, 230985, 232077, 234756, 235193, 234757, 235190, 237925, 238507, 237926, 238508, 238509, 238505, 238506, 237924, 242323, 242508, 242324, 242505, 242325, 242326, 242502, 242327, 242322, 242500, 241668, 242633, 242499, 242320, 242496, 242328, 231986, 249939, 235194, 236331, 234412, 231987, 232068, 231825, 234372, 235198, 234553, 236322, 236319, 235195, 234551, 236320, 235202, 235200, 236324, 238087, 231828, 249446, 249367, 249961, 248968, 244958, 245046, 241231, 241158, 241185, 245054, 244933, 244911, 244935, 245055, 244961, 244932, 241187, 241200, 241145, 241232, 241210, 245041, 246538, 244974, 245044, 244938, 244929, 245042, 244903, 237916, 234556, 232045, 245058, 244927, 244906, 246543, 244936, 244959, 245057, 241144, 244931, 246540, 241213, 237246, 241234, 241159, 237247, 241188, 241211, 241201, 241212, 241214, 244912, 244930, 244960, 244940, 244904, 246541, 244926, 237248, 237249, 245060, 248518, 245958, 245959, 245375, 245955, 245957, 245956, 238504, 238070, 237922, 238079, 238529, 238088, 238503, 238528, 238089, 238600, 238527, 238076, 238074, 238071, 241773, 242315, 241772, 241812, 242472, 241771, 241625, 242494, 242493, 241814, 241554, 241556, 242475, 242334, 242314, 241565, 242477, 242175, 241546, 241769, 242176, 241547, 242593, 241568, 244582, 244773, 244777, 244772, 244776, 244775, 244771, 251829, 248418, 248411, 248464, 248416, 248519, 248463, 248166, 248520, 248165, 251827, 248159, 248158, 248157, 248460, 251828, 248517, 248156, 250899, 251826, 250893, 249962, 249364, 249311, 250896, 251143, 249583, 249315, 250686, 248498, 250219, 250683, 248413, 248412, 248420, 250608, 248415, 250605, 250599, 248161, 248160, 248417, 248459, 248421, 248164, 248163, 248462, 248521, 248419, 248162);
DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done=1;

SET done=0;

OPEN masterCursor;
ticket_loop: LOOP 
FETCH masterCursor into ticket_id,customer_ids,compnay_locations;

IF done THEN
CLOSE masterCursor;
LEAVE ticket_loop;
END IF;

SET done_holder=done;
IF compnay_locations IS NOT NULL THEN
select name into Company_Name from location where id=compnay_locations;
END IF;
IF customer_ids IS NOT NULL THEN
select name into Customer_Names from customer where id=customer_ids;
END IF;

SELECT id into bill_history_id from invoice_detail_new where tickt_id=ticket_id;

SET done=done_holder;


update invoice_detail_new set tcompany=Company_Name,bill_customer_name=Customer_Names 

where id=bill_history_id;


SET bill_history_id=null;

SET Customer_Names=null;

SET Company_Name=null;

END LOOP ticket_loop;

END