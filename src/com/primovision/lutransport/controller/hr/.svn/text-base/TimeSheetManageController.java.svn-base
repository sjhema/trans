package com.primovision.lutransport.controller.hr;

import java.text.DecimalFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.StringTokenizer;

import javax.servlet.http.HttpServletRequest;
import javax.validation.ValidationException;
import java.util.GregorianCalendar;

import org.apache.commons.lang.StringUtils;
import org.apache.poi.util.IntegerField;
import org.joda.time.DateTime;
import org.joda.time.DateTimeConstants;
import org.joda.time.LocalDate;
import org.joda.time.format.DateTimeFormat;
import org.joda.time.format.DateTimeFormatter;
import org.springframework.beans.propertyeditors.CustomDateEditor;
import org.springframework.beans.propertyeditors.CustomNumberEditor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.ui.ModelMap;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.WebDataBinder;
import org.springframework.web.bind.annotation.InitBinder;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;


import com.google.gson.Gson;
import com.primovision.lutransport.controller.CRUDController;
import com.primovision.lutransport.controller.editor.AbstractModelEditor;
import com.primovision.lutransport.core.util.MathUtil;
import com.primovision.lutransport.model.BillingRate;
import com.primovision.lutransport.model.Driver;
import com.primovision.lutransport.model.Location;
import com.primovision.lutransport.model.Ticket;
import com.primovision.lutransport.model.hr.Attendance;
import com.primovision.lutransport.model.hr.Eligibility;
//import com.primovision.lutransport.model.hr.Employee;
import com.primovision.lutransport.model.hr.EmployeeCatagory;
import com.primovision.lutransport.model.hr.HoursMinutes;
import com.primovision.lutransport.model.hr.LeaveCurrentBalance;
import com.primovision.lutransport.model.hr.LeaveType;
import com.primovision.lutransport.model.hr.Minutes;
import com.primovision.lutransport.model.hr.HourlyRate;
import com.primovision.lutransport.model.hr.Ptod;
import com.primovision.lutransport.model.hr.Ptodapplication;
import com.primovision.lutransport.model.hr.ShiftCalendar;
import com.primovision.lutransport.model.hr.TimeSheet;
import com.primovision.lutransport.model.SearchCriteria;
/*import com.primovision.lutransport.model.State;*/
import com.primovision.lutransport.model.StaticData;
/*import com.primovision.lutransport.model.Vehicle;*/

/**
 * @author Subodh
 */

@Controller
@RequestMapping("/hr/timesheetmanage")
public class TimeSheetManageController extends CRUDController<TimeSheet> {

	public TimeSheetManageController() {
		setUrlContext("/hr/timesheetmanage");
	}
	private static SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
	
	@Override
	public void initBinder(WebDataBinder binder) {
		// SimpleDateFormat("yyyy-MM-dd")
		SimpleDateFormat dateFormat = new SimpleDateFormat("MM-dd-yyyy");
	    dateFormat.setLenient(false);
		binder.registerCustomEditor(Date.class, new CustomDateEditor(dateFormat, true));
		binder.registerCustomEditor(Long.TYPE, new CustomNumberEditor(Long.class, false));
		binder.registerCustomEditor(Driver.class, new AbstractModelEditor(Driver.class));
		binder.registerCustomEditor(ShiftCalendar.class, new AbstractModelEditor(ShiftCalendar.class));
		binder.registerCustomEditor(Location.class, new AbstractModelEditor(Location.class));
		binder.registerCustomEditor(EmployeeCatagory.class, new AbstractModelEditor(EmployeeCatagory.class));
		
	}

	
	@Override
	public void setupCreate(ModelMap model, HttpServletRequest request) {
		Map criterias = new HashMap();
		
		criterias.put("type", 3);
		model.addAttribute("companies",genericDAO.findByCriteria(Location.class, criterias, "name", false));
		criterias.clear();
		criterias.put("type", 4);
		model.addAttribute("terminals", genericDAO.findByCriteria(Location.class, criterias, "name", false));
		criterias.clear();
		criterias.put("status", 1);
		model.addAttribute("employees",genericDAO.findByCriteria(Driver.class, criterias, "fullName", false));
		
		model.addAttribute("catagories", genericDAO.findByCriteria(EmployeeCatagory.class, criterias,"name",false));
		
		model.addAttribute("hours", genericDAO.findByCriteria(HoursMinutes.class, criterias,"hoursvalues",false));
		model.addAttribute("minutes", genericDAO.findByCriteria(Minutes.class, criterias,"id",false));
		model.addAttribute("otstatuss", listStaticData("YES_NO"));
		criterias.put("dataType","YES_NO");
		model.addAttribute("dtstatuss", genericDAO.findByCriteria(StaticData.class, criterias,"dataValue",false));
		criterias.clear();
		model.addAttribute("ampm", listStaticData("AM_PM"));
		
		Map criteria = new HashMap();
		criteria.clear();
		criteria.put("dataType", "AM_PM");
		model.addAttribute("pmam", genericDAO.findByCriteria(StaticData.class, criteria,"dataValue",true));
		}

	@Override
	public String list(ModelMap model, HttpServletRequest request) {
		setupList(model, request);
		//setupCreate(model, request);
		//System.out.println("\nlist1\n");
		 SearchCriteria criteria = (SearchCriteria) request.getSession().getAttribute("searchCriteria");
		// System.out.println("\nlist2\n");
		 model.addAttribute("list",genericDAO.search(getEntityClass(), criteria,"driver.fullName",null,null));
		 //System.out.println("\nlist3\n");
		return urlContext + "/list";
	}

	@Override
	public void setupList(ModelMap model, HttpServletRequest request) {
	    populateSearchCriteria(request, request.getParameterMap());
	  //  setupCreate(model, request);
Map criterias = new HashMap();
		
		criterias.put("type", 3);
		model.addAttribute("companies",genericDAO.findByCriteria(Location.class, criterias, "name", false));
		criterias.clear();
		criterias.put("type", 4);
		model.addAttribute("terminals", genericDAO.findByCriteria(Location.class, criterias, "name", false));
		criterias.clear();
		/*criterias.put("status", 1);
		model.addAttribute("employees",genericDAO.findByCriteria(Employee.class, criterias, "fullName", false));*/
		String query="select distinct(obj.fullName) from Driver obj order by obj.fullName";
		model.addAttribute("employees", genericDAO.executeSimpleQuery(query));
		
		model.addAttribute("catagories", genericDAO.findByCriteria(EmployeeCatagory.class, criterias,"name",false));
		
		model.addAttribute("hours", genericDAO.findByCriteria(HoursMinutes.class, criterias,"hoursvalues",false));
		model.addAttribute("minutes", genericDAO.findByCriteria(Minutes.class, criterias,"id",false));
		model.addAttribute("otstatuss", listStaticData("YES_NO"));
		criterias.put("dataType","YES_NO");
		model.addAttribute("dtstatuss", genericDAO.findByCriteria(StaticData.class, criterias,"dataValue",false));
		criterias.clear();
		model.addAttribute("ampm", listStaticData("AM_PM"));
		
	}
	
	//@Override
	/*@RequestMapping(method = RequestMethod.POST, value = "/savet.do")
	
	public String savet(HttpServletRequest request,@ModelAttribute("modelObject") TimeSheet entity,BindingResult bindingResult)
	{
		List<TimeSheet> timeSheets = new ArrayList<TimeSheet>();
		String driver=request.getParameter("driver");
		String catagory=request.getParameter("catagory");
		String company=request.getParameter("company");
		String terminal=request.getParameter("terminal");
		String weeklyHours=request.getParameter("weeklyHours");
		String dailyHours=request.getParameter("dailyHours");
		String batchdate=request.getParameter("batchdate");
		
		
		String[]  dname=request.getParameterValues("day_name");
		String[]  dates=request.getParameterValues("date");
		String[]  tstarthours=request.getParameterValues("timestarthours");
		String[]  tstartminuts=request.getParameterValues("timestartminuts");
		String[]  tendinhours=request.getParameterValues("timeendinhours");
		String[]  tendinminuts=request.getParameterValues("timeendinminuts");
		String[]  hoursworked=request.getParameterValues("hoursworked");
		String[]  otflag=request.getParameterValues("otflag");
		String[]  dtflag=request.getParameterValues("dtflag");
		
	    if(dname.length<2 ||dates.length<2 || tstarthours.length<2 ||tstartminuts.length<2 ||tendinhours.length<2 ||tendinminuts.length<2||hoursworked.length<2)
	    {
	    	request.setAttribute("error","Mendatary Fields Required !");
	    	// setupUpdate(model, request);
		     return urlContext + "/form";
	    }
	    Employee empl=genericDAO.getById(Employee.class, Long.parseLong(driver));
	    EmployeeCatagory empCate=genericDAO.getById(EmployeeCatagory.class, Long.parseLong(catagory));
	    Location com=genericDAO.getById(Location.class, Long.parseLong(company));
	    Location ter=genericDAO.getById(Location.class, Long.parseLong(terminal));
		TimeSheet timesheet =null;
		SimpleDateFormat dateFormat = new SimpleDateFormat("MM-dd-yyyy");
	    for(int i=0;i<2;i++)
	    {
	    	timesheet=new TimeSheet();
	    	
	    	timesheet.setEmployee(empl);
	    	timesheet.setCatagory(empCate);
	    	timesheet.setCompany(com);
	    	timesheet.setTerminal(ter);
	    	timesheet.setWeeklyHours(Double.parseDouble(weeklyHours));
	    	timesheet.setDailyHours(Double.parseDouble(dailyHours));
	    	
	    	//Date d=new Date(batchdate);
	    	//timesheet.setBatchdate(d);
	    	
	    	timesheet.setDay_name(dname[i]);
	    	
	    	//Date d1=new Date(dates[i]);
	    	//timesheet.setDate(d1);
	    	
	    	timesheet.setTimestarthours(tstarthours[i]);
	    	timesheet.setTimestartminuts(tstartminuts[i]);
	    	timesheet.setTimeendinhours(tendinhours[i]);
	    	timesheet.setTimestartminuts(tendinhours[i]);
	    	
	    	timesheet.setHoursworked(Double.parseDouble(hoursworked[i]));
	    	if(!otflag[i].isEmpty()){
	    		timesheet.setOtflag(otflag[i]);
	    	}
	    	else{
	    		timesheet.setOtflag("N");
	    	}
	    	if(!dtflag[i].isEmpty()){
	    		timesheet.setDtflag(dtflag[i]);
	    	}
	    	else{
	    		timesheet.setDtflag("N");
	    	}
	    	
	    	
			System.out.println(otflag[i]);
			
			
			timeSheets.add(timesheet);	
			
		}
	    
	    for(TimeSheet tsheet:timeSheets) {
			
			genericDAO.saveOrUpdate(tsheet);
		}
		if(entity.getEmployee()==null){
			System.out.println("\nentity.getEmployee()==null\n");
			bindingResult.rejectValue("driver", "error.select.option", null, null);
		}
		
		
		
		if(entity.getCompany()==null){
			bindingResult.rejectValue("company", "error.select.option", null, null);
		}
		if(entity.getTerminal()==null){
			bindingResult.rejectValue("terminal", "error.select.option", null, null);
		}
		
		if(entity.getCatagory()==null){
			bindingResult.rejectValue("catagory", "error.select.option", null, null);
		}
		
		if(entity.getTimestarthours()!=null && entity.getTimestartminuts()!=null){
			entity.setSignintime(entity.getTimestarthours()+":"+entity.getTimestartminuts());
		}
		if(entity.getTimeendinhours()!=null && entity.getTimeendinminuts()!=null){
			entity.setSignouttime(entity.getTimeendinhours()+":"+entity.getTimeendinminuts());
		}
		if(entity.getOtflag()==null){
			entity.setOtflag("N");
		}
		if(entity.getDtflag()==null){
			entity.setDtflag("N");
		}
		
		
		//calculating hours worked and OT
		if(entity.getTimestarthours()!=null && !entity.getTimestarthours().isEmpty()  && entity.getTimestartminuts()!=null  &&!entity.getTimestartminuts().isEmpty() && entity.getTimeendinhours()!=null && entity.getTimeendinminuts()!=null ){
			double timeinhours=Double.parseDouble(entity.getTimestarthours());
			double timeinminutes=Double.parseDouble(entity.getTimestartminuts());
		    double timeouthours=Double.parseDouble(entity.getTimeendinhours());
			double timeoutminutes=Double.parseDouble(entity.getTimeendinminuts());
			int timeinhours=Integer.parseInt(entity.getTimestarthours());
			int timeinminutes=Integer.parseInt(entity.getTimestartminuts());
			int timeouthours=Integer.parseInt(entity.getTimeendinhours());
			int timeoutminutes=Integer.parseInt(entity.getTimeendinminuts());
			double ot=0.0;
			DecimalFormat frmt = new DecimalFormat("#.00");
			
			
			
			int workedHours=timeouthours-timeinhours;
			int workedMinutes=timeoutminutes-timeinminutes;
			
			double totalworkedtime=workedHours+(workedMinutes/100.0);
			//totalworkedtime = MathUtil.roundUp(totalworkedtime, 2);
			//frmt.format(totalworkedtime);
			entity.setHoursworked(totalworkedtime);
			
			System.out.println("\nworkedHours===>"+workedHours+"\n");
			System.out.println("\nworkedMinutes===>"+workedMinutes+"\n");
			System.out.println("\ntotalworkedtime===>"+totalworkedtime+"\n");
		}
		
		
	
		
		System.out.println("\nbefor try...Timesheet controller\n");
		try {
			getValidator().validate(entity, bindingResult);
		} catch (ValidationException e) {
			e.printStackTrace();
			log.warn("Error in validation :" + e);
		}
		// return to form if we had errors
		if (bindingResult.hasErrors()) {
			setupCreate(model, request);
			bindingResult.getFieldError();
		System.out.println("\nsave--bindingResult.hasErrors()=="+bindingResult.getFieldError()+"\n");
			return urlContext + "/form";
		}
		beforeSave(request, entity, model);
		genericDAO.saveOrUpdate(entity);
		// merge into datasource
		//System.out.println("\nsave\n");
		for(TimeSheet ts:entity){
			beforeSave(request, ts, model);
		genericDAO.saveOrUpdate(ts);
		}
		cleanUp(request);
		// return to list
		
		return "redirect:/" + urlContext + "/list.do";
		
	}*/
	
	@Override
	public String save(HttpServletRequest request,@ModelAttribute("modelObject") TimeSheet entity,
			BindingResult bindingResult, ModelMap model) 
	    {
		
		if(entity.getDriver()==null){
			System.out.println("\nentity.getEmployee()==null\n");
			bindingResult.rejectValue("driver", "error.select.option", null, null);
		}
		if(entity.getCompany()==null){
			bindingResult.rejectValue("company", "error.select.option", null, null);
		}
		if(entity.getTerminal()==null){
			bindingResult.rejectValue("terminal", "error.select.option", null, null);
		}
		
		if(entity.getCatagory()==null){
			bindingResult.rejectValue("catagory", "error.select.option", null, null);
		}
		

		
		
		
		
		
		
		/*if(entity.getTimestarthours()!=null && entity.getTimestartminuts()!=null){
			entity.setSignintime(entity.getTimestarthours()+":"+entity.getTimestartminuts());
		}
		if(entity.getTimeendinhours()!=null && entity.getTimeendinminuts()!=null){
			entity.setSignouttime(entity.getTimeendinhours()+":"+entity.getTimeendinminuts());
		}*/
		
		/*if(entity.getSotflag()==null){
			System.out.println("\nsunOtFlag=====>"+entity.getSotflag()+"\n");
			entity.setSotflag("N");
		}
		if(entity.getSdtflag()==null){
			entity.setSdtflag("N");
		}
		
		if(entity.getMtotflag()==null){
			entity.setMtotflag("N");
		}
		if(entity.getMdtflag()==null){
			entity.setMdtflag("N");
		}
		
		if(entity.getTotflag()==null){
			entity.setTotflag("N");
		}
		if(entity.getTdtflag()==null){
			entity.setTdtflag("N");
		}
		
		if(entity.getWotflag()==null){
			entity.setWotflag("N");
		}
		if(entity.getWdtflag()==null){
			entity.setWdtflag("N");
		}
		
		if(entity.getThotflag()==null){
			entity.setThotflag("N");
		}
		if(entity.getThdtflag()==null){
			entity.setThdtflag("N");
		}
		
		if(entity.getFotflag()==null){
			entity.setFotflag("N");
		}
		if(entity.getFdtflag()==null){
			entity.setFdtflag("N");
		}
		
		if(entity.getStotflag()==null){
			entity.setFotflag("N");
		}
		
		if(entity.getStdtflag()==null){
			entity.setFdtflag("N");
		}*/
		//calculating hours worked and OT
		/*if(entity.getTimestarthours()!=null && !entity.getTimestarthours().isEmpty()  && entity.getTimestartminuts()!=null  &&!entity.getTimestartminuts().isEmpty() && entity.getTimeendinhours()!=null && entity.getTimeendinminuts()!=null ){
			Double timeinhours=Double.parseDouble(entity.getTimestarthours());
			Double timeinminutes=Double.parseDouble(entity.getTimestartminuts());
			Double timeouthours=Double.parseDouble(entity.getTimeendinhours());
			Double timeoutminutes=Double.parseDouble(entity.getTimeendinminuts());
			int timeinhours=Integer.parseInt(entity.getTimestarthours());
			int timeinminutes=Integer.parseInt(entity.getTimestartminuts());
			int timeouthours=Integer.parseInt(entity.getTimeendinhours());
			int timeoutminutes=Integer.parseInt(entity.getTimeendinminuts());
			Double ot=0.0;
			DecimalFormat frmt = new DecimalFormat("#.00");
			
			
			
			Double workedHours=timeouthours-timeinhours;
			Double workedMinutes=timeoutminutes-timeinminutes;
			
			Double totalworkedtime=workedHours+(workedMinutes/100.0);
			//totalworkedtime = MathUtil.roundUp(totalworkedtime, 2);
			//frmt.format(totalworkedtime);
			entity.setHoursworked(totalworkedtime);
			
			System.out.println("\nworkedHours===>"+workedHours+"\n");
			System.out.println("\nworkedMinutes===>"+workedMinutes+"\n");
			System.out.println("\ntotalworkedtime===>"+totalworkedtime+"\n");
		}*/
		
		
	
		
		System.out.println("\nbefor try...TimeSheet controller\n");
		try {
			getValidator().validate(entity, bindingResult);
		} catch (ValidationException e) {
			e.printStackTrace();
			log.warn("Error in validation :" + e);
		}
		// return to form if we had errors
		if (bindingResult.hasErrors()) {
			setupCreate(model, request);
			bindingResult.getFieldError();
		   System.out.println("\nsave--bindingResult.hasErrors()=="+bindingResult.getFieldError()+"\n");
			return urlContext + "/form";
		}
		beforeSave(request, entity, model);
		genericDAO.saveOrUpdate(entity);
	    cleanUp(request);
		
		
		return "redirect:/" + urlContext + "/list.do";
		
		
	}
        
	
	protected String processAjaxRequest(HttpServletRequest request,String action, Model model) 
	{
		if("findDCompany".equalsIgnoreCase(action)){
			if(!StringUtils.isEmpty(request.getParameter("driver"))){
				List<Location> company=new ArrayList<Location>();
				Driver driver=genericDAO.getById(Driver.class,Long.parseLong(request.getParameter("driver")));
				company.add(driver.getCompany());
				company.add(driver.getTerminal());
				Gson gson = new Gson();
				return gson.toJson(company);
			}
		
		}
		
		if("findhours".equalsIgnoreCase(action)){
			if(!StringUtils.isEmpty(request.getParameter("driver"))){
				Driver driver=genericDAO.getById(Driver.class,Long.parseLong(request.getParameter("driver")));
				Map criterias = new HashMap();
				criterias.put("driver",driver);
				HourlyRate hourlyrate = genericDAO.getByCriteria(HourlyRate.class, criterias);
				List jsonres=new ArrayList();
				if(hourlyrate!=null){
				jsonres.add(hourlyrate.getWeeklyHours());
				jsonres.add(hourlyrate.getDailyHours());
				}
				else{
					jsonres.add(0.0);
					jsonres.add(0.0);
				}
				Gson gson = new Gson();
				return gson.toJson(jsonres);
			}			
		}
		
		if("findDTerminal".equalsIgnoreCase(action)){
			if(!StringUtils.isEmpty(request.getParameter("driver"))){
				List<Location> terminal=new ArrayList<Location>();
				Driver driver=genericDAO.getById(Driver.class,Long.parseLong(request.getParameter("driver")));
				terminal.add(driver.getTerminal());
				Gson gson = new Gson();
				return gson.toJson(terminal);
			}
		
		}
		
		if("findDCategory".equalsIgnoreCase(action)){
			if(!StringUtils.isEmpty(request.getParameter("driver"))){
				List<EmployeeCatagory> category=new ArrayList<EmployeeCatagory>();
				Driver driver=genericDAO.getById(Driver.class,Long.parseLong(request.getParameter("driver")));
				category.add(driver.getCatagory());
				Gson gson = new Gson();
				return gson.toJson(category);
			}
		
		}
		
		if("allDaysOfWeek".equalsIgnoreCase(action)){
			try {
				List<String> list = new ArrayList<String>();
				SimpleDateFormat dateFormat1 = new SimpleDateFormat("yyyy-MM-dd");				
				SimpleDateFormat sdf = new SimpleDateFormat("MM-dd-yyyy");
			
			String batchdate=dateFormat1.format(sdf.parse(request.getParameter("batchDate")));				
			
		
			LocalDate now = new LocalDate(batchdate);
			LocalDate monday = now.withDayOfWeek(DateTimeConstants.MONDAY);
			list.add(sdf.format(monday.toDate()));			
			LocalDate tuesday = now.withDayOfWeek(DateTimeConstants.TUESDAY);
			list.add(sdf.format(tuesday.toDate()));	
			LocalDate wednesday = now.withDayOfWeek(DateTimeConstants.WEDNESDAY);
			list.add(sdf.format(wednesday.toDate()));	
			LocalDate thursday = now.withDayOfWeek(DateTimeConstants.THURSDAY);
			list.add(sdf.format(thursday.toDate()));	
			LocalDate friday = now.withDayOfWeek(DateTimeConstants.FRIDAY);
			list.add(sdf.format(friday.toDate()));	
			LocalDate saturday = now.withDayOfWeek(DateTimeConstants.SATURDAY);
			list.add(sdf.format(saturday.toDate()));
			LocalDate sunday = now.withDayOfWeek(DateTimeConstants.SUNDAY);
			list.add(sdf.format(sunday.toDate()));
			Gson gson = new Gson();
			return gson.toJson(list);
			} catch (ParseException e) {				
				return "";
			}
		}
		
		
		if("fidworkedHours".equalsIgnoreCase(action)){
			if(!StringUtils.isEmpty(request.getParameter("signIn")) && !StringUtils.isEmpty(request.getParameter("signInamOrpm")) &&  !StringUtils.isEmpty(request.getParameter("signOut")) && !StringUtils.isEmpty(request.getParameter("signOutamOrpm")))
			{
				//System.out.println("\nfidworkedHours\n");
				List<String> list = new ArrayList<String>();
				String singIn=request.getParameter("signIn");
				String signInamOrpm=request.getParameter("signInamOrpm");
				String signOut=request.getParameter("signOut");
				String signOutamOrpm=request.getParameter("signOutamOrpm");
				
				//System.out.println("\nsignInamOrpm===>"+signInamOrpm+"\n");
				//System.out.println("\ninminutes===>"+signOutamOrpm+"\n");
				
				String inhours=singIn.substring(0,2);
				String inminutes=singIn.substring(3,5);
				String outhours=signOut.substring(0,2);
				String outminutes=signOut.substring(3,5);
				//System.out.println("\nin hours===>"+inhours+"\n");
				//System.out.println("\nin minutes===>"+inminutes+"\n");
				//System.out.println("\nout hours===>"+outhours+"\n");
				//System.out.println("\nout minutes===>"+outminutes+"\n");
				
				
				Double timeinhours = Double.valueOf(inhours);
				if(timeinhours==12){
					timeinhours=0.0;
				}
				Double timeinminutes= Double.valueOf(inminutes);
				Double timeouthours= Double.valueOf(outhours);
				if(timeouthours==12){
					timeouthours=0.0;
				}
				Double timeoutminutes= Double.valueOf(outminutes);
				
				if(signInamOrpm.equals("AM") && signOutamOrpm.equals("PM")){
					//System.out.println("\nAM-PM\n");
					timeouthours=timeouthours+12;
					if(timeoutminutes< timeinminutes){
						timeouthours=timeouthours-1;
						timeoutminutes=timeoutminutes+60;
					}
					
				}
				
				if(signInamOrpm.equals("AM") && signOutamOrpm.equals("AM")){
					//System.out.println("\nAM-AM\n");
					if(timeoutminutes< timeinminutes){
						timeouthours=timeouthours-1;
						timeoutminutes=timeoutminutes+60;
					}
				}
				
				if(signInamOrpm.equals("PM") && signOutamOrpm.equals("PM")){
					//System.out.println("\nPM-PM\n");
					if(timeoutminutes< timeinminutes){
						timeouthours=timeouthours-1;
						timeoutminutes=timeoutminutes+60;
					}
				}
				
				if(signInamOrpm.equals("PM") && signOutamOrpm.equals("AM")){
					//System.out.println("\nAM-PM\n");
					timeouthours=timeouthours+12;
					if(timeoutminutes< timeinminutes){
						timeouthours=timeouthours-1;
						timeoutminutes=timeoutminutes+60;
					}
					
				}
				
				/*if(timeoutminutes< timeinminutes){
					timeouthours=timeouthours-1;
					timeoutminutes=timeoutminutes+60;
				}*/
				
				
				Double workedHours=timeouthours-timeinhours;
				Double workedMinutes=timeoutminutes-timeinminutes;
				
				
				Double totalworkedtime=workedHours+(workedMinutes/100.0);
				DecimalFormat df = new DecimalFormat("#0.00");
				String wHours = df.format(totalworkedtime);
				
				//System.out.println("\nwHours===>"+wHours+"\n");
				
				list.add(wHours);
				Gson gson = new Gson();
				return gson.toJson(list);
			}
		
		}
		
		
		if("totalworkedHours".equalsIgnoreCase(action)){
			/*if(!StringUtils.isEmpty(request.getParameter("tstarthours")) && !StringUtils.isEmpty(request.getParameter("tsminuts")) &&  !StringUtils.isEmpty(request.getParameter("tendinhours")) && !StringUtils.isEmpty(request.getParameter("tendinminuts")))
			{*/
				System.out.println("\nfind TOTAL workedHours\n");
				List<String> list = new ArrayList<String>();
				
				String SSWhours= request.getParameter("SWhours");
				Double h1=0.0;
			    int m1=0;
			    if(SSWhours !=null && SSWhours.length()>0){
			    	StringTokenizer sst = new StringTokenizer(SSWhours, ".");
			    	String hh1=null;
			    	String mm1=null;
			    	if(sst.countTokens()>1){
			    		hh1=sst.nextElement().toString();
			    		mm1=sst.nextElement().toString();
			    		if(mm1.length()==1){
			    			mm1=mm1+"0";
			    		}
			    		//System.out.println("\nmm1===>"+mm1+"\n");
			    	}
			    	/*Double h1 = Double.valueOf(hh1);
			    	int m1 = Integer.valueOf(mm1);*/
			        h1 = Double.valueOf(hh1);
			        m1 = Integer.valueOf(mm1);
			    }
			    
			    String SMWhours= request.getParameter("MWhours");
			    Double h2=0.0;
			    int m2=0;
			    if(SMWhours !=null && SMWhours.length()>0){
			    	StringTokenizer mst = new StringTokenizer(SMWhours, ".");
			    	String hh2=null;
			    	String mm2=null;
			    	if(mst.countTokens()>1){
			    		hh2=mst.nextElement().toString();
			    		mm2=mst.nextElement().toString();
			    		if(mm2.length()==1){
			    			mm2=mm2+"0";
			    		}
			    		//System.out.println("\nmm2===>"+mm2+"\n");
			    	}
			    	/*Double h2 = Double.valueOf(hh2);
			    	int m2 = Integer.valueOf(mm2);*/
			    	h2 = Double.valueOf(hh2);
			    	m2 = Integer.valueOf(mm2);
			    }
			    
			    
			    String STWhours= request.getParameter("TWhours");
			    Double h3=0.0;
			    int m3=0;
			    if(STWhours !=null && STWhours.length()>0){
			    	StringTokenizer tst = new StringTokenizer(STWhours, ".");
			    	String hh3=null;
			    	String mm3=null;
			    	if(tst.countTokens()>1){
			    		hh3=tst.nextElement().toString();
			    		mm3=tst.nextElement().toString();
			    		if(mm3.length()==1){
			    			mm3=mm3+"0";
			    		}
			    		//System.out.println("\nmm3===>"+mm3+"\n");
			    	}
			    	/*Double h3 = Double.valueOf(hh3);
			    	int m3 = Integer.valueOf(mm3);*/
			    	h3 = Double.valueOf(hh3);
			    	m3 = Integer.valueOf(mm3);
			    }
			    
			    
			    String SWWhours= request.getParameter("WWhours");
			    Double h4=0.0;
			    int m4=0;
			    if(SWWhours !=null && SWWhours.length()>0){
			    	StringTokenizer wst = new StringTokenizer(SWWhours, ".");
			    	String hh4=null;
			    	String mm4=null;
			    	if(wst.countTokens()>1){
			    		hh4=wst.nextElement().toString();
			    		mm4=wst.nextElement().toString();
			    		if(mm4.length()==1){
			    			mm4=mm4+"0";
			    		}
			    		//System.out.println("\nmm4===>"+mm4+"\n");
			    	}
			    	/*Double h4 = Double.valueOf(hh4);
			    	int m4 = Integer.valueOf(mm4);*/
			    	h4 = Double.valueOf(hh4);
			    	m4 = Integer.valueOf(mm4);
			    }
	
			    
			    String STHWhours= request.getParameter("THWhours");
			    Double h5=0.0;
			    int m5=0;
			    if(STHWhours !=null && STHWhours.length()>0){
			    	StringTokenizer rhst = new StringTokenizer(STHWhours, ".");
			    	String hh5=null;
			    	String mm5=null;
			    	if(rhst.countTokens()>1){
			    		hh5=rhst.nextElement().toString();
			    		mm5=rhst.nextElement().toString();
			    		if(mm5.length()==1){
			    			mm5=mm5+"0";
			    		}
			    		//System.out.println("\nmm5===>"+mm5+"\n");
			    	}
			    	/*Double h5 = Double.valueOf(hh5);
			    	int m5 = Integer.valueOf(mm5);*/
			    	h5 = Double.valueOf(hh5);
			    	m5 = Integer.valueOf(mm5);
			    }
			    
			    String SFWhours= request.getParameter("FWhours");
			    Double h6=0.0;
			    int m6=0;
			    if(SFWhours !=null && SFWhours.length()>0){
			    	StringTokenizer fst = new StringTokenizer(SFWhours, ".");
			    	String hh6=null;
			    	String mm6=null;
			    	if(fst.countTokens()>1){
			    		hh6=fst.nextElement().toString();
			    		mm6=fst.nextElement().toString();
			    		if(mm6.length()==1){
			    			mm6=mm6+"0";
			    		}
			    		//System.out.println("\nmm6===>"+mm6+"\n");
			    	}
			    	/*Double h6 = Double.valueOf(hh6);
			    	int m6 = Integer.valueOf(mm6);*/
			    	h6 = Double.valueOf(hh6);
			    	m6 = Integer.valueOf(mm6);
			    }
			    
			    String SSTWhours= request.getParameter("STWhours");
			    Double h7 = 0.0;
			    int m7=0;
			    if(SSTWhours !=null && SSTWhours.length()>0){
			    	StringTokenizer stst = new StringTokenizer(SSTWhours, ".");
			    	String hh7=null;
			    	String mm7=null;
			    	if(stst.countTokens()>1){
			    		hh7=stst.nextElement().toString();
			    		mm7=stst.nextElement().toString();
			    		if(mm7.length()==1){
			    			mm7=mm7+"0";
			    		}
					//System.out.println("\nmm7===>"+mm7+"\n");
			    	}
			 
			    	/*Double h7 = Double.valueOf(hh7);
			    	int m7 = Integer.valueOf(mm7);*/
			    	h7 = Double.valueOf(hh7);
			    	m7 = Integer.valueOf(mm7);
			    }
			    Double totalHH=h1+h2+h3+h4+h5+h6+h7;
			   // Double roundUpHH=
			    int totalMM=m1+m2+m3+m4+m5+m6+m7;
			    //System.out.println("\nHours===>"+totalHH+"\n");
				//System.out.println("\nMinutes===>"+totalMM+"\n");
			   
				if(totalMM>59){
					int extHours=totalMM/60;
					int newminuts=totalMM%60;
					 totalHH=totalHH+extHours+(newminuts/100.00);
					 
					 /* System.out.println("\n*Hours===>"+totalHH+"\n");
					  System.out.println("\n*Minutes===>"+totalMM+"\n");
					  System.out.println("\nextHours===>"+extHours+"\n");
					  System.out.println("\nExactHours===>"+totalHH+"\n");
					  System.out.println("\nnewminuts===>"+newminuts+"\n");*/
				}
				else{
					totalHH=totalHH+(totalMM/100.00);
				}
			    
			    //For round Up and dound Up value
				Double roundUptotalHH=0.00;
				Double roundUptotalMM=0.00;
				
				Double roundUptotalvalueHH=0.00;
				Double roundUptotalvalueMM=0.00;
				
				/*DecimalFormat df1 = new DecimalFormat();
				  String roundUpHHMM=df1.format(totalHH);*/
				String roundUpHHMM=totalHH+"";
				//System.out.println("\nroundUpHHMM====>"+roundUpHHMM+"\n");
				  
				StringTokenizer strroundUpHHMM = new StringTokenizer(roundUpHHMM, ".");
				//System.out.println("\nstrroundUpHHMM.countTokens()====>"+strroundUpHHMM.countTokens()+"\n");
				String roundhh=null;
				String roundmm=null;
				if(strroundUpHHMM.countTokens()>1){
				   roundhh=strroundUpHHMM.nextElement().toString();
				   roundmm=strroundUpHHMM.nextElement().toString();
				   
				   if(roundmm.length()==1){
					   roundmm=roundmm+"0";
					}
				   /*System.out.println("\nroundhh===>"+roundhh+"\n");
				  System.out.println("\nroundmm===>"+roundmm+"\n");*/
				}
				
				 Double doubleroundhh=Double.valueOf(roundhh);
				 Double doubleroundmm=Double.valueOf(roundmm);
				 
				 roundUptotalHH=roundUptotalHH+doubleroundhh;
				 roundUptotalvalueHH=roundUptotalvalueHH+doubleroundhh;
				 
				 if(doubleroundmm>0 && doubleroundmm<=15){
					
					 roundUptotalMM=0.15;
					 if(doubleroundmm>=7)
					  roundUptotalvalueMM=0.25;
					 else
						 roundUptotalvalueMM=0.00;
				 }
				 if(doubleroundmm>15 && doubleroundmm<=30){
					 roundUptotalMM=0.30;
					 if(doubleroundmm>=22)
					 roundUptotalvalueMM=0.50;
					 else
						roundUptotalvalueMM=0.25;
				 }
				 if(doubleroundmm>30 && doubleroundmm<=45){
					 roundUptotalMM=0.45;
					 if(doubleroundmm>=37)
					  roundUptotalvalueMM=0.75;
					 else
						 roundUptotalvalueMM=0.50; 
				 }
				 if(doubleroundmm>45){
					 roundUptotalHH=roundUptotalHH+1;
					 if(doubleroundmm>=52)
					  roundUptotalvalueHH=roundUptotalvalueHH+1;
					 else
						 roundUptotalvalueMM=0.75;
				 }
				 
				 Double roundUptotalHHMM=roundUptotalHH+roundUptotalMM;
				 Double roundUptotalvalueHHMM=roundUptotalvalueHH+roundUptotalvalueMM;
				/* System.out.println("\nroundUptotalHHMM===>"+roundUptotalHHMM+"\n");
				 System.out.println("\nroundUptotalvalueHHMM===>"+roundUptotalvalueHHMM+"\n");*/
				 
				/*Double SWhours = Double.valueOf(request.getParameter("SWhours"));
				Double MWhours= Double.valueOf(request.getParameter("MWhours"));
				Double TWhours= Double.valueOf(request.getParameter("TWhours"));
				Double WWhours= Double.valueOf(request.getParameter("WWhours"));
				Double THWhours= Double.valueOf(request.getParameter("THWhours"));
				Double FWhours= Double.valueOf(request.getParameter("FWhours"));
				Double STWhours= Double.valueOf(request.getParameter("STWhours"));*/
				
				
				//OT FLAGS
				String Sot=request.getParameter("Sot");
				String Mot=request.getParameter("Mot");
				String Tot=request.getParameter("Tot");
				String Wot=request.getParameter("Wot");
				String THot=request.getParameter("THot");
				String Fot=request.getParameter("Fot");
				String STot=request.getParameter("STot");
			    //System.out.println("\not===>"+ Sot +" "+ Mot +" "+ Tot +" "+ Wot +" "+ THot +" "+ Fot +" "+ STot +"\n");
				//DT FLAGS
				String Sdt=request.getParameter("Sdt");
				String Mdt=request.getParameter("Mdt");
				String Tdt=request.getParameter("Tdt");
				String Wdt=request.getParameter("Wdt");
				String THdt=request.getParameter("THdt");
				String Fdt=request.getParameter("Fdt");
				String STdt=request.getParameter("STdt");
				//System.out.println("\ndt===>"+ Sdt +" "+ Mdt +" "+ Tdt +" "+ Wdt +" "+ THdt +" "+ Fdt +" "+ STdt +"\n");
				
				Double reguHours=0.0;
				Double otHours=0.0;
				Double otHoursRounded=0.0;
				int otMinuts=0;
				Double dtHours=0.0;
				int dtMinuts=0;
				if(!StringUtils.isEmpty(request.getParameter("weeklyHours")) && !request.getParameter("weeklyHours").equalsIgnoreCase("0.0") ){
					Double weeklyHours= Double.valueOf(request.getParameter("weeklyHours"));
					if(weeklyHours==0.0){
						reguHours=roundUptotalvalueHHMM;
					}
					else{
					reguHours=weeklyHours;
					//otHours=totalHH-weeklyHours;
					}
					if(weeklyHours > 0.0){
						otHours=roundUptotalvalueHHMM-weeklyHours;
						if(otHours>0.0){
						//do nothing
						}
						else{
						otHours=0.0;
						}
					}
					else if (weeklyHours <= 0.0){
						otHours=0.0;
					}
					System.out.println("\notHours====>"+otHours+"\n");
				}
				else
				{
					if((StringUtils.isEmpty(request.getParameter("weeklyHours")) || request.getParameter("weeklyHours").equalsIgnoreCase("0.0")) && (! StringUtils.isEmpty(request.getParameter("dailyregularHours")) && !request.getParameter("dailyregularHours").equalsIgnoreCase("0.0")))
					{	
						Double dailyregularHours= Double.valueOf(request.getParameter("dailyregularHours"));
						if(SSWhours !=null && SSWhours.length()>0){
							reguHours=dailyregularHours+reguHours;
						
							//reguHours=dailyregularHours*7;
							if(Sdt.equalsIgnoreCase("yes")){
								dtHours=dtHours+(h1-dailyregularHours);
								dtMinuts=dtMinuts+(m1);
							}
							else{
								if(Sot.equalsIgnoreCase("Yes")){
									otHours=otHours+(h1-dailyregularHours);
									otMinuts=otMinuts+m1;
								}
							}
						}
						
						if(SMWhours !=null && SMWhours.length()>0){
							reguHours=dailyregularHours+reguHours;
						
							if(Mdt.equalsIgnoreCase("yes")){
								dtHours=dtHours+(h2-dailyregularHours);
								dtMinuts=dtMinuts+(m2);
							}
							else{
			   		         	if(Mot.equalsIgnoreCase("Yes")){
			   		        	 otHours=otHours+(h2-dailyregularHours);
						    	 otMinuts=otMinuts+m2;
			   		         	}
							}
						}
						
						if(STWhours !=null && STWhours.length()>0)
						{
							reguHours=dailyregularHours+reguHours;
							if(Tdt.equalsIgnoreCase("yes")){
								dtHours=dtHours+(h3-dailyregularHours);
								dtMinuts=dtMinuts+m3;
							}
							else{
			   		         	if(Tot.equalsIgnoreCase("Yes")){
			   		         		otHours=otHours+(h3-dailyregularHours);
			   		         		otMinuts=otMinuts+m3;
			   		         	}
							}
						}
						
						if(SWWhours !=null && SWWhours.length()>0){
							reguHours=dailyregularHours+reguHours;
							if(Wdt.equalsIgnoreCase("yes")){
								dtHours=dtHours+(h4-dailyregularHours);
								dtMinuts=dtMinuts+(m4);
							}
							else{
								if(Wot.equalsIgnoreCase("Yes")){
									otHours=otHours+(h4-dailyregularHours);
									otMinuts=otMinuts+m4;
								}
							}
						}	
							
						 if(STHWhours !=null && STHWhours.length()>0){
							 reguHours=dailyregularHours+reguHours; 
							 if(THdt.equalsIgnoreCase("yes")){
									 dtHours=dtHours+(h5-dailyregularHours);
									 dtMinuts=dtMinuts+m5;
							 }
							 else{
								 if(THot.equalsIgnoreCase("Yes")){
									 otHours=otHours+(h5-dailyregularHours);
									 otMinuts=otMinuts+m5;
								 	}
							 }
						 }
						
						 if(SFWhours !=null && SFWhours.length()>0){
							 reguHours=dailyregularHours+reguHours; 
							 if(Fdt.equalsIgnoreCase("yes")){
									 dtHours=dtHours+(h6-dailyregularHours);
									 dtMinuts=dtMinuts+m6;
							 }
							 else{
								 if(Fot.equalsIgnoreCase("Yes")){
									 otHours=otHours+(h6-dailyregularHours);
									 otMinuts=otMinuts+m6;
								 }
							 }
						 }
						
						if(SSTWhours !=null && SSTWhours.length()>0){
							reguHours=dailyregularHours+reguHours; 
							if(STdt.equalsIgnoreCase("yes")){
								dtHours=dtHours+(h7-dailyregularHours);
								dtMinuts=dtMinuts+m7;
							}
							else{
			   		         	if(STot.equalsIgnoreCase("Yes")){
			   		         		otHours=otHours+(h7-dailyregularHours);
			   		         		otMinuts=otMinuts+m7;
			   		         	}
							}
						}
					}
					else{
						reguHours=roundUptotalvalueHHMM;
						otHours=0.0;
					}
					
					double otMinutsForRound=0.0;
				    if(otMinuts>59){
						  int extOtHours=otMinuts/60;
						  int newOtminuts=otMinuts%60;
						  otMinutsForRound=newOtminuts;
						  //otHours=otHours+extOtHours+(newOtminuts/100.00);
						  otHours=otHours+extOtHours;
					}
				    else{
				    	//otHours=otHours+(otMinuts/100.00);
				    	otMinutsForRound=otMinuts;
				    }
				    
				     double RoundminutsOT= getRoundUpHours(otMinutsForRound );
				     if(otMinutsForRound>=52){
				    	 otHours=1+otHours+RoundminutsOT;
				     }
				     else{
				    	 otHours=otHours+RoundminutsOT;
				     }
				     System.out.println("OT hours rounded==>"+otHours+"\n");
				     
				     
				     double dtMinutsForRound=0.0;
				    if(dtMinuts>59){
						  int extdtHours=dtMinuts/60;
						  int newdtminuts=dtMinuts%60;
						  dtMinutsForRound=newdtminuts;
						  //dtHours=dtHours+extdtHours+(newdtminuts/100.00);
						  dtHours=dtHours+extdtHours;
				    }
				    else{
					   //dtHours=dtHours+(dtMinuts/100.00);
				    	dtMinutsForRound=dtMinuts;
				    }
				    
				    double RoundminutsDT= getRoundUpHours(dtMinutsForRound );
				    if(dtMinutsForRound>=52){
				    	dtHours=1+dtHours+RoundminutsDT;
				    }
				    else{
				    	dtHours=dtHours+RoundminutsDT;
				    }
				    System.out.println("dT hours rounded==>"+dtHours+"\n");
				 
				}
				
			
				
				DecimalFormat df = new DecimalFormat("#0.00");
				String twHours = df.format(totalHH);
				String regularHours = df.format(reguHours);
				String totalotHours = df.format(otHours);
				String totaldtHours = df.format(dtHours);
				
				
				String roundHHMM = df.format(roundUptotalHHMM);
				String roundvalueHHMM = df.format(roundUptotalvalueHHMM);
				/*System.out.println("\ntotalweekly worked Hours===>"+twHours+"\n");
				System.out.println("\ntotalweekly regular hours===>"+regularHours+"\n");
				System.out.println("\ntotal ot Hours===>"+totalotHours+"\n");
				System.out.println("\ntotal dt Hours===>"+dtHours+"\n");*/
				
				if(totalHH < reguHours)
				{
					list.add(twHours);
					list.add(roundvalueHHMM);
				}
				else{
					list.add(twHours);
					list.add(regularHours);
				}
					
				
				list.add(totalotHours);
				list.add(totaldtHours);
				
				list.add(roundHHMM);
				list.add(roundvalueHHMM);
				
				Gson gson = new Gson();
				return gson.toJson(list);		
		}
	return "";
   }
	
	 double getRoundUpHours(double doubleroundmm){
		 double roundUptotalvalueMM=0.0;
		 if(doubleroundmm>0 && doubleroundmm<=15){
				
			
			 if(doubleroundmm>=7)
			  roundUptotalvalueMM=0.25;
			 else
				 roundUptotalvalueMM=0.00;
		 }
		 if(doubleroundmm>15 && doubleroundmm<=30){
			 
			 if(doubleroundmm>=22)
			 roundUptotalvalueMM=0.50;
			 else
				roundUptotalvalueMM=0.25;
		 }
		 if(doubleroundmm>30 && doubleroundmm<=45){
			
			 if(doubleroundmm>=37)
			  roundUptotalvalueMM=0.75;
			 else
				 roundUptotalvalueMM=0.50; 
		 }
		 if(doubleroundmm>45){
			
			 if(doubleroundmm>=52)
				 roundUptotalvalueMM=0.00;
			 else
				 roundUptotalvalueMM=0.75;
		 }
		 
		 
		 return roundUptotalvalueMM; 
	 }
	
	
}
